{%- comment -%}
  Modern Video Section
  ====================
  YouTube/Vimeo embed or self-hosted with custom thumbnail and play button.
{%- endcomment -%}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .modern-video__header {
    text-align: center;
    margin-bottom: var(--space-2xl);
    max-width: 600px;
    margin-inline: auto;
  }
  .modern-video__title {
    font-size: var(--text-3xl);
    font-weight: 700;
    margin: 0;
    letter-spacing: var(--tracking-tight);
  }
  .modern-video__subtitle {
    font-size: var(--text-base);
    opacity: 0.6;
    margin: var(--space-md) 0 0;
  }

  .modern-video-container {
    position: relative;
    max-width: {{ section.settings.max_width }}px;
    margin: 0 auto;
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-2xl);
  }
  .modern-video-container--full {
    max-width: 100%;
    border-radius: 0;
  }

  .modern-video-wrapper {
    position: relative;
    padding-bottom: 56.25%;
    height: 0;
    background: #000;
  }
  .modern-video-wrapper iframe,
  .modern-video-wrapper video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 0;
  }

  .modern-video-thumbnail {
    position: absolute;
    inset: 0;
    z-index: 2;
    cursor: pointer;
    transition: opacity var(--duration-normal) var(--ease-out);
  }
  .modern-video-thumbnail.is-hidden {
    opacity: 0;
    pointer-events: none;
  }
  .modern-video-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .modern-video-thumbnail__overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.3);
    transition: background var(--duration-fast) var(--ease-out);
  }
  .modern-video-thumbnail:hover .modern-video-thumbnail__overlay {
    background: rgba(0,0,0,0.4);
  }
  .modern-video-play-btn {
    width: 80px;
    height: 80px;
    background: rgba(255,255,255,0.95);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform var(--duration-fast) var(--ease-out), box-shadow var(--duration-fast) var(--ease-out);
    box-shadow: var(--shadow-lg);
  }
  .modern-video-thumbnail:hover .modern-video-play-btn {
    transform: scale(1.1);
    box-shadow: var(--shadow-2xl);
  }
  .modern-video-play-btn svg {
    width: 32px;
    height: 32px;
    margin-left: 4px;
    color: #000;
  }

  /* Text overlay on video */
  .modern-video-text-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: var(--space-3xl) var(--space-2xl) var(--space-2xl);
    background: linear-gradient(transparent, rgba(0,0,0,0.7));
    color: #fff;
    z-index: 1;
  }
  .modern-video-text-overlay h3 {
    font-size: var(--text-xl);
    font-weight: 700;
    margin: 0 0 var(--space-xs);
  }
  .modern-video-text-overlay p {
    font-size: var(--text-sm);
    opacity: 0.8;
    margin: 0;
  }
{%- endstyle -%}

<div class="color-{{ section.settings.color_scheme }} gradient">
  <div class="{% if section.settings.layout == 'full_width' %}{% else %}page-width{% endif %} section-{{ section.id }}-padding">
    {%- if section.settings.title != blank or section.settings.subtitle != blank -%}
      <div class="modern-video__header modern-animate animate--fade-up">
        {%- if section.settings.title != blank -%}
          <h2 class="modern-video__title">{{ section.settings.title }}</h2>
        {%- endif -%}
        {%- if section.settings.subtitle != blank -%}
          <p class="modern-video__subtitle">{{ section.settings.subtitle | escape }}</p>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="modern-video-container{% if section.settings.layout == 'full_width' %} modern-video-container--full{% endif %} modern-animate animate--scale">
      <div class="modern-video-wrapper" id="VideoWrapper-{{ section.id }}">
        {%- if section.settings.video_url != blank -%}
          {%- comment -%} YouTube or Vimeo embed - loaded on play {%- endcomment -%}
          <div id="VideoEmbed-{{ section.id }}"></div>
        {%- elsif section.settings.shopify_video != blank -%}
          {{ section.settings.shopify_video | video_tag:
            autoplay: false,
            controls: true,
            muted: false,
            loop: section.settings.loop,
            id: 'ShopifyVideo-' | append: section.id
          }}
        {%- endif -%}
      </div>

      {%- comment -%} Custom Thumbnail {%- endcomment -%}
      {%- if section.settings.thumbnail != blank -%}
        <div class="modern-video-thumbnail" id="VideoThumb-{{ section.id }}" onclick="(function(el){el.classList.add('is-hidden');var w=document.getElementById('VideoEmbed-{{ section.id }}');if(w){var url='{{ section.settings.video_url | escape }}';var id='';if(url.indexOf('youtube')>-1||url.indexOf('youtu.be')>-1){var m=url.match(/(?:v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);if(m)id=m[1];w.innerHTML='<iframe src=\"https://www.youtube.com/embed/'+id+'?autoplay=1&rel=0\" allow=\"autoplay;encrypted-media\" allowfullscreen style=\"position:absolute;inset:0;width:100%;height:100%;border:0\"></iframe>'}else if(url.indexOf('vimeo')>-1){var m2=url.match(/vimeo\.com\/(\d+)/);if(m2)id=m2[1];w.innerHTML='<iframe src=\"https://player.vimeo.com/video/'+id+'?autoplay=1\" allow=\"autoplay\" allowfullscreen style=\"position:absolute;inset:0;width:100%;height:100%;border:0\"></iframe>'}}var v=document.getElementById('ShopifyVideo-{{ section.id }}');if(v){v.play()}})(this)">
          {{ section.settings.thumbnail | image_url: width: 1600 | image_tag:
            alt: section.settings.title | default: 'Video thumbnail',
            widths: '600, 800, 1200, 1600',
            sizes: '100vw',
            loading: 'lazy'
          }}
          <div class="modern-video-thumbnail__overlay">
            <div class="modern-video-play-btn">
              <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            </div>
          </div>
        </div>
      {%- endif -%}

      {%- if section.settings.overlay_text != blank -%}
        <div class="modern-video-text-overlay">
          <h3>{{ section.settings.overlay_text | escape }}</h3>
          {%- if section.settings.overlay_subtext != blank -%}
            <p>{{ section.settings.overlay_subtext | escape }}</p>
          {%- endif -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Modern Video",
  "tag": "section",
  "class": "section-modern-video",
  "settings": [
    { "type": "text", "id": "title", "label": "Heading" },
    { "type": "text", "id": "subtitle", "label": "Subtitle" },
    { "type": "header", "content": "Video Source" },
    { "type": "text", "id": "video_url", "label": "YouTube or Vimeo URL", "info": "Paste a YouTube or Vimeo video URL" },
    { "type": "video", "id": "shopify_video", "label": "Shopify-hosted video" },
    { "type": "image_picker", "id": "thumbnail", "label": "Custom thumbnail" },
    { "type": "checkbox", "id": "loop", "default": false, "label": "Loop video" },
    { "type": "header", "content": "Text Overlay" },
    { "type": "text", "id": "overlay_text", "label": "Overlay heading" },
    { "type": "text", "id": "overlay_subtext", "label": "Overlay subtext" },
    { "type": "header", "content": "Layout" },
    { "type": "select", "id": "layout", "label": "Layout", "options": [{ "value": "contained", "label": "Contained" }, { "value": "full_width", "label": "Full width" }], "default": "contained" },
    { "type": "range", "id": "max_width", "min": 600, "max": 1400, "step": 50, "default": 1000, "unit": "px", "label": "Max width (contained)" },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "background-1" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "default": 52, "unit": "px", "label": "Padding top" },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "default": 52, "unit": "px", "label": "Padding bottom" }
  ],
  "presets": [{ "name": "Modern Video" }]
}
{% endschema %}
